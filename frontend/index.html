<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Match Day Sync - –ì–ª–∞–≤–Ω–∞—è</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script>
        // –°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        (function () {
            // –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            const allowedPages = ['aut.html', 'reg.html'];
            const currentPage = window.location.pathname.split('/').pop() || 'index.html';

            const token = localStorage.getItem('authToken');
            const isLoggedIn = !!token;

            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏ –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∑–∞—â–∏—â–µ–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            if (!isLoggedIn && !allowedPages.includes(currentPage)) {
                sessionStorage.setItem('redirectUrl', window.location.href);
                window.location.href = 'aut.html';
            }

            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏ –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            if (isLoggedIn && allowedPages.includes(currentPage)) {
                window.location.href = 'index.html';
            }
        })();
    </script>
    <style>
        .event-card {
            transition: transform 0.3s;
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .event-card:hover {
            transform: translateY(-5px);
        }

        .sport-icon {
            width: 32px;
            height: 32px;
        }

        .map-preview {
            height: 150px;
            background: linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%);
        }

        .category-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 2;
        }

        .collapsed .bi-chevron-down {
            display: inline-block;
        }

        .collapsed .bi-chevron-up {
            display: none;
        }

        .not-collapsed .bi-chevron-down {
            display: none;
        }

        .not-collapsed .bi-chevron-up {
            display: inline-block;
        }

        .sports-filter-btn {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 0.5rem 0;
            font-weight: 500;
        }

        .loading-spinner {
            display: none;
        }
    </style>
</head>

<body>
    <!-- –®–∞–ø–∫–∞ -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="logo.jpg" alt="MDS" height="60">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="my_events.html">–ú–æ–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    <div class="dropdown">
                        <button class="btn btn-light dropdown-toggle d-flex align-items-center" type="button"
                            data-bs-toggle="dropdown">
                            <img src="Person.svg" class="me-2" width="32" height="32" alt="–ü—Ä–æ—Ñ–∏–ª—å">
                            <span id="headerUserName">–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="profile.html">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a></li>
                            <li><a class="dropdown-item" href="my_events.html">–ú–æ–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</a></li>
                            <li><a class="dropdown-item" href="settings.html">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item text-danger" href="aut.html">–í—ã–π—Ç–∏</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="container my-4">
        <div class="row">
            <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="col-lg-3 mb-4">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        –§–∏–ª—å—Ç—Ä—ã –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">–î–∞—Ç–∞</label>
                            <select class="form-select" id="dateFilter">
                                <option value="all">–õ—é–±–∞—è</option>
                                <option value="today">–°–µ–≥–æ–¥–Ω—è</option>
                                <option value="tomorrow">–ó–∞–≤—Ç—Ä–∞</option>
                                <option value="weekend">–ù–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <button class="btn btn-link p-0 text-start sports-filter-btn" type="button"
                                data-bs-toggle="collapse" data-bs-target="#sportsCollapse" aria-expanded="false"
                                aria-controls="sportsCollapse">
                                –í–∏–¥ —Å–ø–æ—Ä—Ç–∞
                                <span>
                                    <i class="bi bi-chevron-down"></i>
                                    <i class="bi bi-chevron-up"></i>
                                </span>
                            </button>

                            <div class="collapse" id="sportsCollapse">
                                <div class="mt-2" id="sportsFilterContainer">
                                    <!-- –§–∏–ª—å—Ç—Ä—ã –≤–∏–¥–æ–≤ —Å–ø–æ—Ä—Ç–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                                </div>
                            </div>
                        </div>

                        <button class="btn btn-primary w-100" id="applyFiltersBtn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
                        <button class="btn btn-outline-secondary w-100 mt-2" id="resetFiltersBtn">–°–±—Ä–æ—Å–∏—Ç—å
                            —Ñ–∏–ª—å—Ç—Ä—ã</button>
                    </div>
                </div>

                <!-- –ë–ª–æ–∫ "–í–∞—à–∏ —Å–æ–±—ã—Ç–∏—è" -->
                <div class="card mt-4">
                    <div class="card-header bg-info text-white">
                        –í–∞—à–∏ —Å–æ–±—ã—Ç–∏—è
                    </div>
                    <ul class="list-group list-group-flush" id="userEventsList">
                        <!-- –°–æ–±—ã—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </ul>
                </div>
            </div>

            <!-- –õ–µ–Ω—Ç–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π -->
            <div class="col-lg-9">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h2>
                    <div class="input-group me-3">
                        <input type="text" class="form-control" placeholder="–ù–∞–π—Ç–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ" id="searchInput">
                        <button class="btn btn-outline-primary" type="button" id="searchBtn">
                            <i class="bi bi-search"></i>
                        </button>
                    </div>
                    <a href="create.html">
                        <button class="btn btn-success">
                            <i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ
                        </button>
                    </a>
                </div>

                <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π -->
                <div class="row row-cols-1 row-cols-md-2 g-4" id="eventsContainer">
                    <!-- –°–æ–±—ã—Ç–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>

                <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
                <div class="text-center my-5" id="loadingIndicator">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π...</p>
                </div>

                <!-- –°–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ–≥–¥–∞ –Ω–µ—Ç —Å–æ–±—ã—Ç–∏–π -->
                <div class="text-center d-none" id="noEventsMessage">
                    <p>–ù–µ—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤–∞—à–∏–º —Ñ–∏–ª—å—Ç—Ä–∞–º.</p>
                </div>
            </div>
        </div>
    </div>


    <!-- –§—É—Ç–µ—Ä -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <h5>Match Day Sync</h5>
                    <p>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –∏ –ø–æ–∏—Å–∫–∞ –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤.</p>
                </div>
                <div class="col-md-4 mb-3">
                    <h5>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h5>
                    <ul class="list-unstyled">
                        <li><i class="bi bi-envelope me-2"></i> contact@MatchDaySync</li>
                        <li><i class="bi bi-telephone me-2"></i> +7 (495) 123-45-67</li>
                    </ul>
                </div>
                <div class="col-md-4 mb-3">
                    <h5>–ú—ã –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö</h5>
                    <div class="d-flex gap-3">
                        <a href="#" class="text-white fs-4"><i class="bi bi-telegram"></i></a>
                        <a href="#" class="text-white fs-4"><i class="bi bi-vk"></i></a>
                    </div>
                </div>
            </div>
            <hr class="bg-light">
            <div class="text-center">
                <small>¬© 2025 Match Day Sync. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</small>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        function logout() {
            localStorage.removeItem('authToken');
            window.location.href = 'aut.html';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserProfile() {
            const token = localStorage.getItem('authToken');
            if (!token) return;

            try {
                const response = await fetch('/api/user', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const user = await response.json();
                    document.getElementById('headerUserName').textContent = user.full_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                    return user;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:', error);
            }
            return null;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–±—ã—Ç–∏–π
        async function loadEvents(filters = {}) {
            try {
                // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                document.getElementById('loadingIndicator').classList.remove('d-none');
                document.getElementById('noEventsMessage').classList.add('d-none');

                // –°–æ–∑–¥–∞—Ç—å URL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
                const params = new URLSearchParams();
                if (filters.sportType) params.append('sport_type', filters.sportType);
                if (filters.date) {
                    const today = new Date();
                    switch (filters.date) {
                        case 'today':
                            params.append('date_from', today.toISOString().split('T')[0]);
                            params.append('date_to', today.toISOString().split('T')[0]);
                            break;
                        case 'tomorrow':
                            const tomorrow = new Date(today);
                            tomorrow.setDate(tomorrow.getDate() + 1);
                            params.append('date_from', tomorrow.toISOString().split('T')[0]);
                            params.append('date_to', tomorrow.toISOString().split('T')[0]);
                            break;
                        case 'weekend':
                            // –õ–æ–≥–∏–∫–∞ –¥–ª—è –≤—ã—Ö–æ–¥–Ω—ã—Ö
                            break;
                    }
                }
                if (filters.search) params.append('search', filters.search);

                const url = `/api/events?${params.toString()}`;

                const response = await fetch(url);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–±—ã—Ç–∏–π');

                const events = await response.json();
                renderEvents(events);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–±—ã—Ç–∏–π:', error);
                document.getElementById('eventsContainer').innerHTML = `
                    <div class="col-12">
                        <div class="alert alert-danger">${error.message}</div>
                    </div>
                `;
            } finally {
                document.getElementById('loadingIndicator').classList.add('d-none');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π
        function renderEvents(events) {
            const container = document.getElementById('eventsContainer');
            container.innerHTML = '';

            if (events.length === 0) {
                document.getElementById('noEventsMessage').classList.remove('d-none');
                return;
            }

            events.forEach(event => {
                const eventCard = createEventCard(event);
                container.innerHTML += eventCard;
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞—Ç—ã
        function createEventDate(event) {
            if (!event.event_date || !event.event_time) {
                console.error('Missing date or time for event:', event.id);
                return null;
            }

            try {
                const datePart = new Date(event.event_date);
                if (isNaN(datePart.getTime())) return null;

                const [hours, minutes] = event.event_time.split(':');
                datePart.setHours(parseInt(hours, 10));
                datePart.setMinutes(parseInt(minutes, 10));

                return datePart;
            } catch (error) {
                console.error('Error creating date for event:', event.id, error);
                return null;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–æ–±—ã—Ç–∏—è
        function createEventCard(event) {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–∫–æ–Ω–∫—É –∏ —Ç–µ–∫—Å—Ç –¥–ª—è —Ü–µ–Ω—ã
            const price = parseFloat(event.price);
            const priceText = price > 0 ? `${price.toFixed(2)} ‚ÇΩ` : '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ';
            const priceClass = price > 0 ? 'bg-warning text-dark' : 'bg-danger';

            // –ò–∫–æ–Ω–∫–∞ –≤–∏–¥–∞ —Å–ø–æ—Ä—Ç–∞
            const sportIcons = {
                running: 'running.svg',
                cycling: 'cycling.svg',
                football: 'football.svg',
                basketball: 'basketball.svg',
                tennis: 'tennis.svg',
                volleyball: 'volleyball.svg',
                swimming: 'swimming.svg',
                yoga: 'yoga.svg'
            };

            const sportIcon = sportIcons[event.sport_type] || 'default.svg';

            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –æ—à–∏–±–æ–∫
            let formattedDate = event.event_date;
            let formattedTime = event.event_time.substring(0, 5);

            const eventDateObj = createEventDate(event);
            if (eventDateObj) {
                formattedDate = eventDateObj.toLocaleDateString('ru-RU', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });

                formattedTime = eventDateObj.toLocaleTimeString('ru-RU', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            // –£—á–∞—Å—Ç–Ω–∏–∫–∏
            const participantsText = event.max_participants
                ? `${event.participant_count || 0}/${event.max_participants}`
                : (event.participant_count || 0);

            return `
        <div class="col">
            <div class="card h-100 event-card">
                <span class="category-badge badge ${priceClass}">${priceText}</span>
                <div class="map-preview"></div>
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <h5 class="card-title">${event.title}</h5>
                        <img src="${sportIcon}" class="sport-icon" alt="${event.sport_type}">
                    </div>
                    <p class="card-text">
                        <i class="bi bi-calendar"></i> ${formattedDate}<br>
                        <i class="bi bi-clock"></i> ${formattedTime}<br>
                        <i class="bi bi-geo-alt"></i> ${event.location}<br>
                        <i class="bi bi-people"></i> ${participantsText} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
                    </p>
                    <div class="d-flex justify-content-between">
                        <a href="event-details.html?id=${event.id}" class="btn btn-outline-primary">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                        <button class="btn btn-primary participate-btn" data-event-id="${event.id}">–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å</button>
                    </div>
                </div>
            </div>
        </div>
    `;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–±—ã—Ç–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserEvents() {
            const token = localStorage.getItem('authToken');
            if (!token) return;

            try {
                const user = await loadUserProfile();
                if (!user) return;

                const response = await fetch(`/api/events?organizer_id=${user.id}`);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–±—ã—Ç–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');

                const events = await response.json();
                renderUserEvents(events);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–±—ã—Ç–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function renderUserEvents(events) {
            const container = document.getElementById('userEventsList');
            container.innerHTML = '';

            if (events.length === 0) {
                container.innerHTML = `
                    <li class="list-group-item text-center">
                        –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ–±—ã—Ç–∏–π
                    </li>
                `;
                return;
            }

            events.slice(0, 3).forEach(event => {
                const eventDate = new Date(`${event.event_date}T${event.event_time}`);
                const now = new Date();
                const diffTime = eventDate - now;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                let badgeText, badgeClass;
                if (diffDays < 0) {
                    badgeText = '–ó–∞–≤–µ—Ä—à–µ–Ω–æ';
                    badgeClass = 'bg-secondary';
                } else if (diffDays === 0) {
                    badgeText = '–°–µ–≥–æ–¥–Ω—è';
                    badgeClass = 'bg-success';
                } else if (diffDays === 1) {
                    badgeText = '–ó–∞–≤—Ç—Ä–∞';
                    badgeClass = 'bg-primary';
                } else if (diffDays <= 7) {
                    badgeText = `–ß–µ—Ä–µ–∑ ${diffDays} –¥–Ω.`;
                    badgeClass = 'bg-info';
                } else {
                    badgeText = eventDate.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' });
                    badgeClass = 'bg-light text-dark';
                }

                container.innerHTML += `
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        ${event.title}
                        <span class="badge ${badgeClass}">${badgeText}</span>
                    </li>
                `;
            });

            if (events.length > 3) {
                container.innerHTML += `
                    <li class="list-group-item text-center">
                        <a href="my_events.html">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ (${events.length})</a>
                    </li>
                `;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function initFilters() {
            // –í–∏–¥—ã —Å–ø–æ—Ä—Ç–∞
            const sports = [
                { id: 'running', name: 'üèÉ –ë–µ–≥' },
                { id: 'cycling', name: 'üö¥ –í–µ–ª–æ—Å–ø–æ—Ä—Ç' },
                { id: 'football', name: '‚öΩ –§—É—Ç–±–æ–ª' },
                { id: 'basketball', name: 'üèÄ –ë–∞—Å–∫–µ—Ç–±–æ–ª' },
                { id: 'tennis', name: 'üéæ –¢–µ–Ω–Ω–∏—Å' },
                { id: 'volleyball', name: 'üèê –í–æ–ª–µ–π–±–æ–ª' },
                { id: 'swimming', name: 'üèä –ü–ª–∞–≤–∞–Ω–∏–µ' },
                { id: 'yoga', name: 'üßò –ô–æ–≥–∞' }
            ];

            const container = document.getElementById('sportsFilterContainer');
            sports.forEach(sport => {
                container.innerHTML += `
                    <div class="form-check">
                        <input class="form-check-input sport-filter" type="checkbox" id="${sport.id}" value="${sport.id}">
                        <label class="form-check-label" for="${sport.id}">
                            ${sport.name}
                        </label>
                    </div>
                `;
            });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', async function () {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
            initFilters();

            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            await loadUserProfile();

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            await loadUserEvents();

            // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π
            await loadEvents();

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
            document.getElementById('applyFiltersBtn').addEventListener('click', applyFilters);
            document.getElementById('resetFiltersBtn').addEventListener('click', resetFilters);
            document.getElementById('searchBtn').addEventListener('click', applyFilters);
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') applyFilters();
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã—Ö–æ–¥–∞
            document.getElementById('logoutLink').addEventListener('click', (e) => {
                e.preventDefault();
                logout();
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–æ–∫ "–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å"
            document.addEventListener('click', async function (e) {
                if (e.target.classList.contains('participate-btn')) {
                    const eventId = e.target.dataset.eventId;
                    const token = localStorage.getItem('authToken');

                    if (!token) {
                        alert('–î–ª—è —É—á–∞—Å—Ç–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É');
                        return;
                    }

                    try {
                        const response = await fetch(`/api/events/${eventId}/participate`, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        if (response.ok) {
                            alert('–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å –Ω–∞ —Å–æ–±—ã—Ç–∏–µ!');
                            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–±—ã—Ç–∏—è
                            loadEvents();
                        } else {
                            const error = await response.json();
                            throw new Error(error.error || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
                        }
                    } catch (error) {
                        alert(`–û—à–∏–±–∫–∞: ${error.message}`);
                    }
                }
            });
        });

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function applyFilters() {
            const filters = {};

            // –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ
            filters.date = document.getElementById('dateFilter').value;

            // –§–∏–ª—å—Ç—Ä –ø–æ –≤–∏–¥—É —Å–ø–æ—Ä—Ç–∞
            const selectedSports = Array.from(document.querySelectorAll('.sport-filter:checked'))
                .map(checkbox => checkbox.value);

            if (selectedSports.length > 0) {
                filters.sportType = selectedSports.join(',');
            }

            // –ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
            const searchQuery = document.getElementById('searchInput').value.trim();
            if (searchQuery) {
                filters.search = searchQuery;
            }

            loadEvents(filters);
        }

        // –°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function resetFilters() {
            document.getElementById('dateFilter').value = 'all';
            document.querySelectorAll('.sport-filter').forEach(checkbox => {
                checkbox.checked = false;
            });
            document.getElementById('searchInput').value = '';
            loadEvents();
        }
    </script>
</body>

</html>