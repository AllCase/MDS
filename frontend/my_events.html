<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è - Match Day Sync</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script>
        // –°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        (function () {
            // –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            const allowedPages = ['aut.html', 'reg.html'];
            const currentPage = window.location.pathname.split('/').pop() || 'index.html';

            const token = localStorage.getItem('authToken');
            const isLoggedIn = !!token;

            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏ –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∑–∞—â–∏—â–µ–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            if (!isLoggedIn && !allowedPages.includes(currentPage)) {
                sessionStorage.setItem('redirectUrl', window.location.href);
                window.location.href = 'aut.html';
            }

            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏ –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            if (isLoggedIn && allowedPages.includes(currentPage)) {
                window.location.href = 'index.html';
            }
        })();
    </script>
    <style>
        .event-card {
            transition: transform 0.3s;
            border-radius: 15px;
            overflow: hidden;
            border: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .event-card:hover {
            transform: translateY(-5px);
        }

        .sport-icon {
            width: 32px;
            height: 32px;
        }

        .map-preview {
            height: 150px;
            background: linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%);
            position: relative;
            overflow: hidden;
        }

        .category-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 2;
        }

        .status-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 2;
        }

        .participants-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid white;
            margin-left: -10px;
        }

        .tab-content {
            padding-top: 20px;
        }

        .organizer-badge {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
        }

        .participant-badge {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            background-color: #f8f9fa;
            border-radius: 15px;
            margin-top: 20px;
        }

        .empty-state i {
            font-size: 5rem;
            color: #dee2e6;
            margin-bottom: 20px;
        }

        .filter-card {
            margin-bottom: 20px;
            margin-top: 20px;
        }

        .nav-pills .nav-link.active {
            background: linear-gradient(120deg, #1a2a6c, #b21f1f);
            color: white;
            box-shadow: 0 4px 10px rgba(26, 42, 108, 0.25);
        }

        .nav-pills .nav-link {
            border-radius: 20px;
            padding: 10px 20px;
            margin-bottom: 10px;
            color: #495057;
            font-weight: 500;
        }

        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }
    </style>
</head>

<body>
    <!-- –®–∞–ø–∫–∞ -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="logo.jpg" alt="MDS" height="60">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="my_events.html">–ú–æ–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    <div class="dropdown">
                        <button class="btn btn-light dropdown-toggle d-flex align-items-center" type="button"
                            data-bs-toggle="dropdown">
                            <img src="Person.svg" class="me-2" width="32" height="32" alt="–ü—Ä–æ—Ñ–∏–ª—å">
                            <span id="headerUserName">–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="profile.html">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a></li>
                            <li><a class="dropdown-item active" href="my_events.html">–ú–æ–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</a></li>
                            <li><a class="dropdown-item" href="settings.html">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item text-danger" href="aut.html">–í—ã–π—Ç–∏</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="container py-5">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∏ -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="mb-0">–ú–æ–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h1>
            <div>
                <a href="index.html" class="btn btn-outline-primary me-2">
                    <i class="bi bi-arrow-left me-1"></i> –ù–∞ –≥–ª–∞–≤–Ω—É—é
                </a>
                <a href="create.html">
                    <button class="btn btn-success">
                        <i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ
                    </button>
                </a>
            </div>
        </div>
        <!-- –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="alert alert-info mb-4">
            <h6>üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ endpoint'–æ–≤</h6>
            <div class="btn-group">
                <button class="btn btn-sm btn-outline-primary" onclick="testEndpoint('/api/test/auth')">–¢–µ—Å—Ç
                    –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</button>
                <button class="btn btn-sm btn-outline-secondary" onclick="testEndpoint('/api/test/events-simple')">–¢–µ—Å—Ç
                    –ø—Ä–æ—Å—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞</button>
                <button class="btn btn-sm btn-outline-success" onclick="testEndpoint('/api/test/events-join')">–¢–µ—Å—Ç
                    JOIN</button>
                <button class="btn btn-sm btn-outline-warning" onclick="testEndpoint('/api/test/events-subquery')">–¢–µ—Å—Ç
                    –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞</button>
                <button class="btn btn-sm btn-outline-danger" onclick="testEndpoint('/api/events/participating')">–¢–µ—Å—Ç
                    participating</button>
                <button class="btn btn-sm btn-outline-info" onclick="testEndpoint('/api/events/organizing')">–¢–µ—Å—Ç
                    organizing</button>
            </div>
        </div>
        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <ul class="nav nav-tabs mb-4" id="eventsTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="participating-tab" data-bs-toggle="tab"
                    data-bs-target="#participating" type="button" role="tab">
                    <i class="bi bi-person-check me-1"></i> –£—á–∞—Å—Ç–≤—É—é
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="organizing-tab" data-bs-toggle="tab" data-bs-target="#organizing"
                    type="button" role="tab">
                    <i class="bi bi-megaphone me-1"></i> –û—Ä–≥–∞–Ω–∏–∑—É—é
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="past-tab" data-bs-toggle="tab" data-bs-target="#past" type="button"
                    role="tab">
                    <i class="bi bi-clock-history me-1"></i> –ü—Ä–æ—à–µ–¥—à–∏–µ
                </button>
            </li>
        </ul>
        <div class="tab-content" id="eventsTabContent">
            <!-- –í–∫–ª–∞–¥–∫–∞ "–£—á–∞—Å—Ç–≤—É—é" -->
            <div class="tab-pane fade show active" id="participating" role="tabpanel">
                <div class="row">
                    <!-- –§–∏–ª—å—Ç—Ä—ã -->
                    <div class="col-lg-3 mb-4">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <!-- –ö–Ω–æ–ø–∫–∞ "–ù–∞ –≥–ª–∞–≤–Ω—É—é" –≤ –±–æ–∫–æ–≤–æ–º –º–µ–Ω—é -->
                                <a href="index.html" class="btn btn-outline-primary mb-3 w-100">
                                    <i class="bi bi-house-door me-1"></i> –ù–∞ –≥–ª–∞–≤–Ω—É—é
                                </a>

                                <ul class="nav nav-pills flex-column">
                                    <li class="nav-item">
                                        <a class="nav-link" href="profile.html"><i class="bi bi-person me-2"></i> –û–±–∑–æ—Ä
                                            –ø—Ä–æ—Ñ–∏–ª—è</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link active" href="my_events.html"><i
                                                class="bi bi-calendar-event me-2"></i> –ú–æ–∏
                                            –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="settings.html"><i class="bi bi-gear me-2"></i>
                                            –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
                                    </li>
                                    <li class="nav-item mt-3">
                                        <a class="nav-link text-danger" href="aut.html"><i
                                                class="bi bi-box-arrow-right me-2"></i>
                                            –í—ã–π—Ç–∏</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="card filter-card">
                            <div class="card-header bg-primary text-white">
                                –§–∏–ª—å—Ç—Ä—ã –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                                    <select class="form-select" id="statusFilter">
                                        <option value="all">–í—Å–µ</option>
                                        <option value="active" selected>–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                                        <option value="completed">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ</option>
                                        <option value="cancelled">–û—Ç–º–µ–Ω—ë–Ω–Ω—ã–µ</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">–î–∞—Ç–∞</label>
                                    <select class="form-select" id="dateFilter">
                                        <option value="all">–õ—é–±–∞—è</option>
                                        <option value="today">–°–µ–≥–æ–¥–Ω—è</option>
                                        <option value="tomorrow">–ó–∞–≤—Ç—Ä–∞</option>
                                        <option value="week">–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ</option>
                                        <option value="month">–í —ç—Ç–æ–º –º–µ—Å—è—Ü–µ</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">–í–∏–¥ —Å–ø–æ—Ä—Ç–∞</label>
                                    <div class="form-check">
                                        <input class="form-check-input sport-filter" type="checkbox" value="running"
                                            id="running-filter" checked>
                                        <label class="form-check-label" for="running-filter">
                                            üèÉ –ë–µ–≥
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input sport-filter" type="checkbox" value="cycling"
                                            id="cycling-filter" checked>
                                        <label class="form-check-label" for="cycling-filter">
                                            üö¥ –í–µ–ª–æ—Å–ø–æ—Ä—Ç
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input sport-filter" type="checkbox" value="football"
                                            id="football-filter">
                                        <label class="form-check-label" for="football-filter">
                                            ‚öΩ –§—É—Ç–±–æ–ª
                                        </label>
                                    </div>
                                </div>

                                <button class="btn btn-primary w-100" id="applyFilters">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
                            </div>
                        </div>
                    </div>

                    <!-- –°–ø–∏—Å–æ–∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π -->
                    <div class="col-lg-9">
                        <div id="participatingEventsContainer" class="row row-cols-1 row-cols-md-2 g-4">
                            <div class="loading-spinner">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ "–û—Ä–≥–∞–Ω–∏–∑—É—é" -->
            <div class="tab-pane fade" id="organizing" role="tabpanel">
                <div class="row">
                    <!-- –§–∏–ª—å—Ç—Ä—ã -->
                    <div class="col-lg-3 mb-4">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <!-- –ö–Ω–æ–ø–∫–∞ "–ù–∞ –≥–ª–∞–≤–Ω—É—é" –≤ –±–æ–∫–æ–≤–æ–º –º–µ–Ω—é -->
                                <a href="index.html" class="btn btn-outline-primary mb-3 w-100">
                                    <i class="bi bi-house-door me-1"></i> –ù–∞ –≥–ª–∞–≤–Ω—É—é
                                </a>

                                <ul class="nav nav-pills flex-column">
                                    <li class="nav-item">
                                        <a class="nav-link" href="profile.html"><i class="bi bi-person me-2"></i> –û–±–∑–æ—Ä
                                            –ø—Ä–æ—Ñ–∏–ª—è</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link active" href="my_events.html"><i
                                                class="bi bi-calendar-event me-2"></i> –ú–æ–∏
                                            –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="settings.html"><i class="bi bi-gear me-2"></i>
                                            –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
                                    </li>
                                    <li class="nav-item mt-3">
                                        <a class="nav-link text-danger" href="aut.html"><i
                                                class="bi bi-box-arrow-right me-2"></i>
                                            –í—ã–π—Ç–∏</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="card filter-card">
                            <div class="card-header bg-info text-white">
                                –§–∏–ª—å—Ç—Ä—ã –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                                    <select class="form-select" id="organizingStatusFilter">
                                        <option value="all">–í—Å–µ</option>
                                        <option value="active" selected>–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                                        <option value="completed">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ</option>
                                        <option value="cancelled">–û—Ç–º–µ–Ω—ë–Ω–Ω—ã–µ</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">–î–∞—Ç–∞</label>
                                    <select class="form-select" id="organizingDateFilter">
                                        <option value="all">–õ—é–±–∞—è</option>
                                        <option value="today">–°–µ–≥–æ–¥–Ω—è</option>
                                        <option value="tomorrow">–ó–∞–≤—Ç—Ä–∞</option>
                                        <option value="week">–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ</option>
                                        <option value="month">–í —ç—Ç–æ–º –º–µ—Å—è—Ü–µ</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">–¢–∏–ø –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</label>
                                    <div class="form-check">
                                        <input class="form-check-input type-filter" type="checkbox" value="training"
                                            id="training-filter" checked>
                                        <label class="form-check-label" for="training-filter">
                                            –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input type-filter" type="checkbox" value="competition"
                                            id="competition-filter">
                                        <label class="form-check-label" for="competition-filter">
                                            –°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è
                                        </label>
                                    </div>
                                </div>

                                <button class="btn btn-info w-100 text-white" id="applyOrganizingFilters">–ü—Ä–∏–º–µ–Ω–∏—Ç—å
                                    —Ñ–∏–ª—å—Ç—Ä—ã</button>
                            </div>
                        </div>
                    </div>

                    <!-- –°–ø–∏—Å–æ–∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π -->
                    <div class="col-lg-9">
                        <div id="organizingEventsContainer" class="row row-cols-1 row-cols-md-2 g-4">
                            <div class="loading-spinner">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ "–ü—Ä–æ—à–µ–¥—à–∏–µ" -->
            <div class="tab-pane fade" id="past" role="tabpanel">
                <div class="row">
                    <!-- –§–∏–ª—å—Ç—Ä—ã -->
                    <div class="col-lg-3 mb-4">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <!-- –ö–Ω–æ–ø–∫–∞ "–ù–∞ –≥–ª–∞–≤–Ω—É—é" –≤ –±–æ–∫–æ–≤–æ–º –º–µ–Ω—é -->
                                <a href="index.html" class="btn btn-outline-primary mb-3 w-100">
                                    <i class="bi bi-house-door me-1"></i> –ù–∞ –≥–ª–∞–≤–Ω—É—é
                                </a>

                                <ul class="nav nav-pills flex-column">
                                    <li class="nav-item">
                                        <a class="nav-link" href="profile.html"><i class="bi bi-person me-2"></i> –û–±–∑–æ—Ä
                                            –ø—Ä–æ—Ñ–∏–ª—è</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link active" href="my_events.html"><i
                                                class="bi bi-calendar-event me-2"></i> –ú–æ–∏
                                            –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="settings.html"><i class="bi bi-gear me-2"></i>
                                            –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
                                    </li>
                                    <li class="nav-item mt-3">
                                        <a class="nav-link text-danger" href="aut.html"><i
                                                class="bi bi-box-arrow-right me-2"></i>
                                            –í—ã–π—Ç–∏</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="card filter-card">
                            <div class="card-header bg-secondary text-white">
                                –§–∏–ª—å—Ç—Ä—ã –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">–ü–µ—Ä–∏–æ–¥</label>
                                    <select class="form-select" id="periodFilter">
                                        <option value="all">–ó–∞ –≤—Å—ë –≤—Ä–µ–º—è</option>
                                        <option value="month" selected>–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü</option>
                                        <option value="3months">–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –º–µ—Å—è—Ü–∞</option>
                                        <option value="year">–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">–†–æ–ª—å</label>
                                    <select class="form-select" id="roleFilter">
                                        <option value="all">–í—Å–µ</option>
                                        <option value="participant">–£—á–∞—Å—Ç–Ω–∏–∫</option>
                                        <option value="organizer">–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">–í–∏–¥ —Å–ø–æ—Ä—Ç–∞</label>
                                    <div class="form-check">
                                        <input class="form-check-input past-sport-filter" type="checkbox"
                                            value="running" id="past-running-filter" checked>
                                        <label class="form-check-label" for="past-running-filter">
                                            üèÉ –ë–µ–≥
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input past-sport-filter" type="checkbox"
                                            value="cycling" id="past-cycling-filter" checked>
                                        <label class="form-check-label" for="past-cycling-filter">
                                            üö¥ –í–µ–ª–æ—Å–ø–æ—Ä—Ç
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input past-sport-filter" type="checkbox"
                                            value="football" id="past-football-filter">
                                        <label class="form-check-label" for="past-football-filter">
                                            ‚öΩ –§—É—Ç–±–æ–ª
                                        </label>
                                    </div>
                                </div>

                                <button class="btn btn-secondary w-100" id="applyPastFilters">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
                            </div>
                        </div>
                    </div>

                    <!-- –°–ø–∏—Å–æ–∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π -->
                    <div class="col-lg-9">
                        <div id="pastEventsContainer" class="row row-cols-1 row-cols-md-2 g-4">
                            <div class="loading-spinner">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –§—É—Ç–µ—Ä -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <h5>Match Day Sync</h5>
                    <p>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –∏ –ø–æ–∏—Å–∫–∞ –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤.</p>
                </div>
                <div class="col-md-4 mb-3">
                    <h5>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h5>
                    <ul class="list-unstyled">
                        <li><i class="bi bi-envelope me-2"></i> contact@MatchDaySync</li>
                        <li><i class="bi bi-telephone me-2"></i> +7 (495) 123-45-67</li>
                    </ul>
                </div>
                <div class="col-md-4 mb-3">
                    <h5>–ú—ã –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö</h5>
                    <div class="d-flex gap-3">
                        <a href="#" class="text-white fs-4"><i class="bi bi-telegram"></i></a>
                        <a href="#" class="text-white fs-4"><i class="bi bi-vk"></i></a>
                    </div>
                </div>
            </div>
            <hr class="bg-light">
            <div class="text-center">
                <small>¬© 2025 Match Day Sync. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</small>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è endpoint'–æ–≤
        async function testEndpoint(endpoint) {
            try {
                console.log(`üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º endpoint: ${endpoint}`);
                const result = await fetchEvents(endpoint);
                console.log(`‚úÖ ${endpoint}:`, result);
                alert(`‚úÖ ${endpoint} —Ä–∞–±–æ—Ç–∞–µ—Ç!\n–î–∞–Ω–Ω—ã–µ: ${JSON.stringify(result).substring(0, 200)}...`);
            } catch (error) {
                console.error(`‚ùå ${endpoint}:`, error);
                alert(`‚ùå ${endpoint} –æ—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
        async function testDB() {
            try {
                const result = await fetchEvents('/api/debug/db-test');
                alert('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞: ' + JSON.stringify(result));
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ë–î: ' + error.message);
            }
        }

        async function testUserEvents() {
            try {
                const user = await fetchUserData();
                const result = await fetchEvents(`/api/debug/user-events/${user.id}`);
                alert(`–°–æ–±—ã—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${result.organizingCount} –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä, ${result.participatingCount} —É—á–∞—Å—Ç–Ω–∏–∫`);
            } catch (error) {
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        async function testTables() {
            try {
                const result = await fetchEvents('/api/debug/tables');
                alert('–¢–∞–±–ª–∏—Ü—ã: ' + result.tables.map(t => t.table_name).join(', '));
            } catch (error) {
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            }
        }
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function fetchUserData() {
            const token = localStorage.getItem('authToken');
            if (!token) return null;

            try {
                const response = await fetch('/api/user', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    return await response.json();
                }
                return null;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                return null;
            }
        }

        // –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ—à–∏–±–∫–∞—Ö
        async function fetchEvents(endpoint) {
            const token = localStorage.getItem('authToken');
            console.log('üîÑ –ó–∞–ø—Ä–æ—Å –∫:', endpoint);

            if (!token) {
                console.error('‚ùå –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω');
                throw new Error('–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è');
            }

            try {
                const response = await fetch(endpoint, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                console.log('üìä –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', response.status);

                const responseText = await response.text();
                console.log('üìÑ –¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞:', responseText);

                if (!response.ok) {
                    let errorData;
                    try {
                        errorData = JSON.parse(responseText);
                    } catch (e) {
                        errorData = { error: responseText || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' };
                    }

                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:', response.status, errorData);
                    throw new Error(errorData.details || errorData.error || `HTTP ${response.status}`);
                }

                try {
                    const data = JSON.parse(responseText);
                    console.log('‚úÖ –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ:', data);
                    return data;
                } catch (e) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', e);
                    throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                }

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π:', error);
                throw error;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã (–£–õ–£–ß–®–ï–ù–ù–ê–Ø)
        function formatDate(dateString) {
            if (!dateString) return '–î–∞—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞';

            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) return dateString;

                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);

                if (date.toDateString() === today.toDateString()) {
                    return '–°–µ–≥–æ–¥–Ω—è';
                } else if (date.toDateString() === tomorrow.toDateString()) {
                    return '–ó–∞–≤—Ç—Ä–∞';
                } else {
                    const options = { day: 'numeric', month: 'long', year: 'numeric' };
                    return date.toLocaleDateString('ru-RU', options);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã:', error);
                return dateString;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π (–û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø)
        function displayEvents(events, containerId, type) {
            const container = document.getElementById(containerId);
            if (!container) {
                console.error('‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω:', containerId);
                return;
            }

            console.log(`üìä –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π (${type}):`, events);

            if (!Array.isArray(events)) {
                console.error('‚ùå –û–∂–∏–¥–∞–ª—Å—è –º–∞—Å—Å–∏–≤ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π, –ø–æ–ª—É—á–µ–Ω–æ:', events);
                container.innerHTML = `
            <div class="col-12">
                <div class="alert alert-danger">
                    –û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
                </div>
            </div>
        `;
                return;
            }

            if (events.length === 0) {
                container.innerHTML = `
            <div class="col-12">
                <div class="empty-state">
                    <i class="bi bi-calendar-x"></i>
                    <h4>–ù–µ—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</h4>
                    <p class="text-muted">${type === 'participating'
                        ? '–í—ã –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç–µ –≤ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö'
                        : type === 'organizing'
                            ? '–í—ã –Ω–µ –æ—Ä–≥–∞–Ω–∏–∑—É–µ—Ç–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è'
                            : '–ù–µ—Ç –ø—Ä–æ—à–µ–¥—à–∏—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π'
                    }.</p>
                    ${type === 'organizing' ? `
                    <a href="create.html" class="btn btn-success mt-3">
                        <i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
                    </a>
                    ` : ''}
                </div>
            </div>
        `;
                return;
            }

            let eventsHTML = '';
            events.forEach(event => {
                // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∞—Ç—ã
                const eventDate = event.event_date ? new Date(event.event_date) : new Date();
                const now = new Date();
                const isPast = eventDate < now;
                const isToday = eventDate.toDateString() === now.toDateString();

                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
                const formattedDate = formatDate(event.event_date);

                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º—è (—É–±–∏—Ä–∞–µ–º —Å–µ–∫—É–Ω–¥—ã –µ—Å–ª–∏ –µ—Å—Ç—å)
                const eventTime = event.event_time ? event.event_time.substring(0, 5) : '00:00';

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (–µ—Å–ª–∏ –Ω–µ—Ç –≤ –¥–∞–Ω–Ω—ã—Ö, —Å—Ç–∞–≤–∏–º 0)
                const participantsCount = event.participants_count || 0;

                eventsHTML += `
            <div class="col">
                <div class="card h-100 event-card">
                    <span class="status-badge badge ${type === 'organizing' ? 'organizer-badge' : 'participant-badge'}">
                        ${type === 'organizing' ? '–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä' : '–£—á–∞—Å—Ç–Ω–∏–∫'}
                    </span>
                    <span class="category-badge badge ${event.price > 0 ? 'bg-warning text-dark' : 'bg-success'}">
                        ${event.price > 0 ? event.price + ' ‚ÇΩ' : '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ'}
                    </span>
                    
                    <div class="map-preview">
                        <div class="d-flex justify-content-center align-items-center h-100 text-muted">
                            <i class="bi bi-geo-alt-fill me-2"></i>
                            ${event.location || '–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è'}
                        </div>
                    </div>
                    
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h5 class="card-title">${event.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h5>
                            <img src="${event.sport_type || 'default'}.svg" class="sport-icon" alt="${event.sport_type || '–°–ø–æ—Ä—Ç'}">
                        </div>
                        
                        <div class="mb-2">
                            <span class="badge bg-light text-dark me-2">
                                <i class="bi bi-tag me-1"></i> 
                                ${getEventTypeText(event.event_type)}
                            </span>
                            <span class="badge ${isPast ? 'bg-secondary' : isToday ? 'bg-success' : 'bg-primary'}">
                                ${isPast ? '–ó–∞–≤–µ—Ä—à–µ–Ω–æ' : isToday ? '–°–µ–≥–æ–¥–Ω—è' : '–ê–∫—Ç–∏–≤–Ω–æ'}
                            </span>
                        </div>
                        
                        <p class="card-text">
                            <i class="bi bi-calendar"></i> <strong>${formattedDate}</strong><br>
                            <i class="bi bi-clock"></i> ${eventTime}<br>
                            <i class="bi bi-geo-alt"></i> ${event.location || '–ú–µ—Å—Ç–æ –Ω–µ —É–∫–∞–∑–∞–Ω–æ'}<br>
                            <i class="bi bi-people"></i> 
                            ${participantsCount} 
                            ${event.max_participants ? `/ ${event.max_participants}` : ''} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
                        </p>
                        
                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <small class="text-muted">
                                –û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä: ${event.organizer_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
                            </small>
                            
                            <div>
                                <a href="event-details.html?id=${event.id}" class="btn btn-outline-primary btn-sm me-2">
                                    <i class="bi bi-eye"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä
                                </a>
                                ${type === 'organizing' && !isPast ? `
                                <button class="btn btn-outline-secondary btn-sm" onclick="editEvent(${event.id})">
                                    <i class="bi bi-pencil"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
            });

            container.innerHTML = eventsHTML;
        }

        // –í–†–ï–ú–ï–ù–ù–û–ï –†–ï–®–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ endpoint'—ã –∫–æ—Ç–æ—Ä—ã–µ —Ç–æ—á–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç
        async function loadParticipatingEvents() {
            const container = document.getElementById('participatingEventsContainer');

            try {
                container.innerHTML = '<div class="loading-spinner"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div></div>';

                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–±–æ—á–∏–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π endpoint
                const user = await fetchUserData();
                const debugData = await fetchEvents(`/api/debug/user-events/${user.id}`);
                const events = debugData.participating;

                console.log('üìã –î–∞–Ω–Ω—ã–µ –¥–ª—è —É—á–∞—Å—Ç–∏—è:', events);
                displayEvents(events, 'participatingEventsContainer', 'participating');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –¥–ª—è —É—á–∞—Å—Ç–∏—è:', error);
                container.innerHTML = `
            <div class="col-12">
                <div class="alert alert-danger">
                    –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è: ${error.message}
                    <br><small>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</small>
                </div>
            </div>
        `;
            }
        }

        async function loadOrganizingEvents() {
            const container = document.getElementById('organizingEventsContainer');

            try {
                container.innerHTML = '<div class="loading-spinner"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div></div>';

                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–±–æ—á–∏–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π endpoint
                const user = await fetchUserData();
                const debugData = await fetchEvents(`/api/debug/user-events/${user.id}`);
                const events = debugData.organizing;

                console.log('üìã –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞:', events);
                displayEvents(events, 'organizingEventsContainer', 'organizing');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑—É–µ–º—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π:', error);
                container.innerHTML = `
            <div class="col-12">
                <div class="alert alert-danger">
                    –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∞—à–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è: ${error.message}
                    <br><small>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</small>
                </div>
            </div>
        `;
            }
        }

        async function loadPastEvents() {
            const container = document.getElementById('pastEventsContainer');

            try {
                container.innerHTML = '<div class="loading-spinner"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div></div>';

                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–±–æ—á–∏–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π endpoint –∏ —Ñ–∏–ª—å—Ç—Ä—É–µ–º –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
                const user = await fetchUserData();
                const debugData = await fetchEvents(`/api/debug/user-events/${user.id}`);
                const allEvents = debugData.organizing.concat(debugData.participating);

                // –§–∏–ª—å—Ç—Ä—É–µ–º –ø—Ä–æ—à–µ–¥—à–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
                const currentDate = new Date().toISOString().split('T')[0];
                const pastEvents = allEvents.filter(event => event.event_date < currentDate);

                console.log('üìã –î–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ—à–µ–¥—à–∏—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π:', pastEvents);
                displayEvents(pastEvents, 'pastEventsContainer', 'past');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—à–µ–¥—à–∏—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π:', error);
                container.innerHTML = `
            <div class="col-12">
                <div class="alert alert-danger">
                    –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—à–µ–¥—à–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è: ${error.message}
                    <br><small>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</small>
                </div>
            </div>
        `;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑—É–µ–º—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
        function displayOrganizingEvents(events, containerId) {
            const container = document.getElementById(containerId);

            if (!events || events.length === 0) {
                container.innerHTML = `
            <div class="col-12">
                <div class="empty-state">
                    <i class="bi bi-megaphone"></i>
                    <h4>–í—ã –ø–æ–∫–∞ –Ω–µ –æ—Ä–≥–∞–Ω–∏–∑—É–µ—Ç–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h4>
                    <p class="text-muted">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—ë –ø–µ—Ä–≤–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –∏ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤!</p>
                    <a href="create.html" class="btn btn-success">
                        <i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ
                    </a>
                </div>
            </div>
        `;
                return;
            }

            let eventsHTML = '';

            events.forEach(event => {
                const eventDateTime = new Date(`${event.event_date}T${event.event_time}`);
                const now = new Date();
                const isPast = eventDateTime < now;
                const isToday = event.event_date === new Date().toISOString().split('T')[0];

                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
                const formattedDate = formatDate(event.event_date);

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–æ–±—ã—Ç–∏—è
                let statusBadge = '';
                let statusText = '';

                if (event.status === 'cancelled') {
                    statusBadge = 'bg-secondary';
                    statusText = '–û—Ç–º–µ–Ω–µ–Ω–æ';
                } else if (isPast) {
                    statusBadge = 'bg-secondary';
                    statusText = '–ó–∞–≤–µ—Ä—à–µ–Ω–æ';
                } else if (isToday) {
                    statusBadge = 'bg-success';
                    statusText = '–°–µ–≥–æ–¥–Ω—è';
                } else {
                    statusBadge = 'bg-primary';
                    statusText = '–ê–∫—Ç–∏–≤–Ω–æ';
                }

                eventsHTML += `
            <div class="col">
                <div class="card h-100 event-card">
                    <span class="status-badge badge organizer-badge">
                        <i class="bi bi-megaphone"></i> –û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä
                    </span>
                    <span class="category-badge badge ${event.price > 0 ? 'bg-warning text-dark' : 'bg-success'}">
                        ${event.price > 0 ? event.price + ' ‚ÇΩ' : '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ'}
                    </span>
                    
                    <div class="map-preview">
                        <div class="d-flex justify-content-center align-items-center h-100 text-muted">
                            <i class="bi bi-geo-alt-fill me-2"></i>
                            ${event.location || '–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è'}
                        </div>
                    </div>
                    
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h5 class="card-title">${event.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h5>
                            <img src="${event.sport_type || 'default'}.svg" class="sport-icon" alt="${event.sport_type || '–°–ø–æ—Ä—Ç'}">
                        </div>
                        
                        <div class="mb-3">
                            <span class="badge ${statusBadge} me-2">${statusText}</span>
                            <span class="badge bg-light text-dark">
                                <i class="bi bi-tag me-1"></i> 
                                ${getEventTypeText(event.event_type)}
                            </span>
                        </div>
                        
                        <p class="card-text">
                            <i class="bi bi-calendar"></i> <strong>${formattedDate}</strong><br>
                            <i class="bi bi-clock"></i> ${event.event_time || '00:00'}<br>
                            <i class="bi bi-geo-alt"></i> ${event.location || '–ú–µ—Å—Ç–æ –Ω–µ —É–∫–∞–∑–∞–Ω–æ'}<br>
                            <i class="bi bi-people"></i> 
                            ${event.participants_count || 0} 
                            ${event.max_participants ? `/ ${event.max_participants}` : ''} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
                        </p>
                        
                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <small class="text-muted">
                                –°–æ–∑–¥–∞–Ω–æ: ${new Date(event.created_at).toLocaleDateString('ru-RU')}
                            </small>
                            
                            <div>
                                <a href="event-details.html?id=${event.id}" class="btn btn-outline-primary btn-sm me-2">
                                    <i class="bi bi-eye"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä
                                </a>
                                ${!isPast && event.status !== 'cancelled' ? `
                                <button class="btn btn-outline-secondary btn-sm" onclick="editEvent(${event.id})">
                                    <i class="bi bi-pencil"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
            });

            container.innerHTML = eventsHTML;
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏—è
        function getEventTypeText(eventType) {
            const types = {
                'training': '–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞',
                'competition': '–°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ',
                'tournament': '–¢—É—Ä–Ω–∏—Ä',
                'friendly': '–¢–æ–≤–∞—Ä–∏—â–µ—Å–∫–∞—è –≤—Å—Ç—Ä–µ—á–∞',
                'marathon': '–ú–∞—Ä–∞—Ñ–æ–Ω',
                'workshop': '–ú–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å'
            };
            return types[eventType] || eventType || '–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ';
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è–º–∏
        async function leaveEvent(eventId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —É—á–∞—Å—Ç–∏–µ –≤ —ç—Ç–æ–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏?')) return;

            const token = localStorage.getItem('authToken');
            try {
                const response = await fetch(`/api/events/${eventId}/participate`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    alert('–£—á–∞—Å—Ç–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ');
                    loadParticipatingEvents();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ —É—á–∞—Å—Ç–∏—è');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ —É—á–∞—Å—Ç–∏—è');
            }
        }

        async function deleteEvent(eventId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ?')) return;

            const token = localStorage.getItem('authToken');
            try {
                const response = await fetch(`/api/events/${eventId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    alert('–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ —É–¥–∞–ª–µ–Ω–æ');
                    loadOrganizingEvents();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏—è
        function editEvent(eventId) {
            window.location.href = `create.html?edit=${eventId}`;
        }

        // –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', async function () {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            const token = localStorage.getItem('authToken');
            if (!token) {
                window.location.href = 'aut.html';
                return;
            }

            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const user = await fetchUserData();
            if (user) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –≤ —à–∞–ø–∫–µ
                const headerUserName = document.getElementById('headerUserName');
                if (headerUserName) {
                    headerUserName.textContent = user.full_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                }
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
            loadParticipatingEvents();

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
            document.addEventListener('DOMContentLoaded', function () {
                const organizingTab = document.getElementById('organizing-tab');

                if (organizingTab) {
                    organizingTab.addEventListener('shown.bs.tab', function () {
                        console.log('–ü–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–û—Ä–≥–∞–Ω–∏–∑—É—é"');
                        loadOrganizingEvents();
                    });
                }
            });
            const participatingTab = document.getElementById('participating-tab');
            const organizingTab = document.getElementById('organizing-tab');
            const pastTab = document.getElementById('past-tab');

            if (participatingTab) {
                participatingTab.addEventListener('shown.bs.tab', function () {
                    loadParticipatingEvents();
                });
            }

            if (organizingTab) {
                organizingTab.addEventListener('shown.bs.tab', function () {
                    loadOrganizingEvents();
                });
            }

            if (pastTab) {
                pastTab.addEventListener('shown.bs.tab', function () {
                    loadPastEvents();
                });
            }

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
            const logoutBtn = document.querySelector('.dropdown-item.text-danger');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function (e) {
                    e.preventDefault();
                    localStorage.removeItem('authToken');
                    window.location.href = 'aut.html';
                });
            }

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
            document.getElementById('applyFilters')?.addEventListener('click', function () {
                loadParticipatingEvents();
            });

            document.getElementById('applyOrganizingFilters')?.addEventListener('click', function () {
                loadOrganizingEvents();
            });

            document.getElementById('applyPastFilters')?.addEventListener('click', function () {
                loadPastEvents();
            });
        });
    </script>
</body>

</html>